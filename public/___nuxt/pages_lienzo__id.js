(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{185:function(e,t,r){},186:function(e,t,r){},187:function(e,t){},216:function(e,t,r){"use strict";var n=r(185);r.n(n).a},217:function(e,t,r){"use strict";var n=r(186);r.n(n).a},218:function(e,t,r){"use strict";var n=r(187),o=r.n(n);t.default=o.a},221:function(e,t,r){"use strict";r.r(t);r(71),r(29),r(21),r(13),r(55),r(17);var n=r(2),o=r(40),c=r(188),l=r.n(c),d=r(189),f=r.n(d),h=r(56),m=r(191),O=r(192);function j(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function v(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?j(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):j(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var y={computed:v({},Object(h.e)(["modo","baseUrl","actual"]),{},Object(h.c)(["previos"])),methods:v({},Object(h.d)(["seleccionarPagina"]))},P=(r(216),r(20)),w=Object(P.a)(y,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"paginas"}},[r("div",{staticClass:"lista"},e._l(e.previos,(function(t,n){return r("div",{staticClass:"pagina",class:{activa:n==e.actual},on:{click:function(t){return e.seleccionarPagina(n)}}},[t.startsWith("data")?r("img",{attrs:{src:t}}):r("img",{attrs:{src:e.baseUrl+"/plantillas/previo/"+t}})])})),0)])}),[],!1,null,null,null).exports,x=r(190);function k(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function S(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?k(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):k(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var $,D,C,I={components:{Fabric:m.a,Opciones:O.a,Acciones:x.a,Paginas:w},data:function(){return{escala:.5,fabric:null,objeto:null,id:null,cliente:0,paginas:[],guardado:!0}},computed:S({},Object(h.e)(["actual","diseño"]),{},Object(h.c)(["pagina"])),watch:{actual:function(e,t){if(null!=this.actual){var r=this.fabric.json();r.previo=this.fabric.obtenerImagen("png",.5),this.guardarPagina({pagina:r,indice:t})}var n=this.pagina;"objetos"in n?this.fabric.cargar(n):(console.debug("loadFromJSON"),this.fabric.lienzo.loadFromJSON(n)),this.$nextTick(this.fabric.actualizar)}},mounted:function(){var e=this;switch(this.fabric=this.$refs.fabric,console.debug("mounted","_id"),this.id=this.$route.params.id,console.debug(this.$route.meta.modo),this.cliente=cliente,this.establecerCliente(this.cliente),this.$route.meta.modo){case"editar":this.cargarDiseño(this.id);break;default:this.cargarPlantilla(this.id)}l.a.bind("4",(function(t){e.fabric.rectangulo({top:200,fill:"fuchsia"})})),l.a.bind("f5",(function(t){e.fabric.actualizar()}))},methods:S({cargarPlantillaX:(C=Object(n.a)(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$axios.$get("plantillas/obtener/".concat(t));case 2:(r=e.sent)&&this.fabric.cargar(r.datos.paginas[0]);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return C.apply(this,arguments)}),"cargarDiseñoX":(D=Object(n.a)(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("carga diseño"),e.next=3,this.$axios.$get("diseños/obtener/".concat(t));case 3:r=e.sent,console.debug(r),r&&this.fabric.lienzo.loadFromJSON(r.datos);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return D.apply(this,arguments)}),herramientasEvento:function(e){switch(e){case"exportar:pdf":this.exportarPdf();break;case"exportar:img":this.exportarImagen()}},accion:function(e){switch(e){case"exportar:pdf":this.exportarPdf();break;case"exportar:img":this.exportarImagen();break;case"guardar":var t=this.fabric.json();t.previo=this.fabric.obtenerImagen("png",.5),this.establecerPrevio(t.previo),this.guardarPagina({pagina:t,indice:this.actual}),this.guardarDiseño();break;case"volver":this.$router.push({path:"/"});break;default:console.log(arguments)}},fabricSelectionCleared:function(e){this.objeto=null},fabricSelection:function(e){this.objeto=e.target},opcionesImagenCargada:function(e){this.fabric.actualizarImagen(this.objeto,e)},exportarPdf:function(){var e=new f.a({orientation:"l",unit:"mm",format:"a4",compress:!0}),img=this.fabric.obtenerImagen("png");e.addImage(img,"PNG",0,0,297,167.0625),e.save("doc.pdf")},exportarImagen:function(){var img=this.fabric.obtenerImagen("png"),e=document.createElement("a");e.href=img,e.target="_blank",e.download="imagen",document.body.appendChild(e),e.click(),document.body.removeChild(e)},guardar:($=Object(n.a)(regeneratorRuntime.mark((function e(t){var r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=this.fabric.json(),n=this.fabric.obtenerImagen("png"),e.t0=this.modo,e.next="editar"===e.t0?5:9;break;case 5:return e.next=7,this.$axios({method:"post",url:"diseños/guardar/".concat(this.id),data:JSON.stringify({nombre:t,datos:r,cliente:this.cliente,previo:n}),headers:{"Content-Type":"application/json"}});case 7:return o=e.sent,e.abrupt("break",12);case 9:return e.next=11,this.$axios({method:"post",url:"diseños/guardar",data:JSON.stringify({nombre:t,datos:r,cliente:this.cliente,previo:n}),headers:{"Content-Type":"application/json"}});case 11:o=e.sent;case 12:"OK"===o.data.estado&&(this.modo="editar",this.id=o.data.id);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return $.apply(this,arguments)})},Object(h.d)(["guardarPagina","establecerPrevio","establecerCliente"]),{},Object(h.b)(["cargarPlantilla","cargarDiseño","guardarDiseño"]))},E=(r(217),r(218)),J=Object(P.a)(I,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"pagina-lienzo"}},[r("paginas"),r("opciones",{ref:"opciones",attrs:{objeto:e.objeto},on:{"imagen-cargada":e.opcionesImagenCargada}}),r("acciones",{on:{accion:e.accion}}),r("fabric",{ref:"fabric",attrs:{ancho:e.diseño.ancho,alto:e.diseño.alto,escala:e.escala},on:{"selection-updated":e.fabricSelection,"selection-created":e.fabricSelection,"selection-cleared":e.fabricSelectionCleared}})],1)}),[],!1,null,"641f476b",null);"function"==typeof E.default&&Object(E.default)(J);t.default=J.exports}}]);